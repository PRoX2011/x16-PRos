; ==================================================================
; x16-PRos -- FNT_TEST. Font and it`s test for your programs.
; Copyright (C) 2025 PRoX2011
;
; Made by PRoX-dev
; =================================================================

[BITS 16]
[ORG 0x8000]

VGA_SEQ_INDEX   equ 0x3C4
VGA_SEQ_DATA    equ 0x3C5
VGA_GC_INDEX    equ 0x3CE
VGA_GC_DATA     equ 0x3CF

SCREEN_WIDTH_B  equ 80
FONT_HEIGHT     equ 8

start:
    mov ax, 0x0012
    int 0x10

    mov ax, 0xA000
    mov es, ax

    mov al, 0x01
    call clear_screen

    mov byte [cursor_x], 2
    mov byte [cursor_y], 2
    mov byte [color_fg], 0x0F
    mov byte [color_bg], 0x01
    mov si, text_header
    call print_string_custom

    mov byte [cursor_x], 5
    mov byte [cursor_y], 5
    mov byte [color_fg], 0x0A
    mov byte [color_bg], 0x00
    mov si, text_msg1
    call print_string_custom

    mov byte [cursor_x], 5
    mov byte [cursor_y], 7
    mov byte [color_fg], 0x0E
    mov byte [color_bg], 0x00
    mov si, text_msg2
    call print_string_custom

    mov byte [cursor_x], 5
    mov byte [cursor_y], 9
    mov byte [color_fg], 0x04
    mov byte [color_bg], 0x00
    mov si, text_msg3
    call print_string_custom

hang:
    jmp hang

print_string_custom:
.next_char:
    lodsb
    test al, al
    jz .done

    cmp al, 10
    je .newline
    cmp al, 13
    je .next_char

    call draw_char_vga12

    inc byte [cursor_x]
    cmp byte [cursor_x], 80
    jae .newline
    jmp .next_char

.newline:
    mov byte [cursor_x], 0
    inc byte [cursor_y]
    jmp .next_char

.done:
    ret

draw_char_vga12:
    pusha

    xor ah, ah
    sub al, 32
    shl ax, 3
    mov bx, ax
    add bx, FontTable

    xor ax, ax
    mov al, [cursor_y]
    mov cx, SCREEN_WIDTH_B * FONT_HEIGHT
    mul cx
    mov di, ax

    xor ax, ax
    mov al, [cursor_x]
    add di, ax

    mov dx, VGA_GC_INDEX
    mov al, 0x05
    out dx, al
    inc dx
    mov al, 0x00
    out dx, al

    mov cx, 8
.draw_row:
    mov ah, [cs:bx]
    inc bx

    push ax
    not ah

    mov dx, VGA_GC_INDEX
    mov al, 0x08
    out dx, al
    inc dx
    mov al, ah
    out dx, al

    mov dx, VGA_SEQ_INDEX
    mov al, 0x02
    out dx, al
    inc dx
    mov al, [color_bg]
    out dx, al

    mov al, [es:di]
    mov byte [es:di], 0xFF

    pop ax

    mov dx, VGA_GC_INDEX
    mov al, 0x08
    out dx, al
    inc dx
    mov al, ah
    out dx, al

    mov dx, VGA_SEQ_INDEX
    mov al, 0x02
    out dx, al
    inc dx
    mov al, [color_fg]
    out dx, al

    mov al, [es:di]
    mov byte [es:di], 0xFF

    add di, 80
    loop .draw_row

    mov dx, VGA_GC_INDEX
    mov al, 0x08
    out dx, al
    inc dx
    mov al, 0xFF
    out dx, al

    popa
    ret

clear_screen:
    pusha

    mov dx, VGA_SEQ_INDEX
    mov al, 0x02
    out dx, al
    inc dx
    mov al, 0x0F
    out dx, al

    mov dx, VGA_GC_INDEX
    mov al, 0x00
    out dx, al
    inc dx
    pop ax
    push ax
    out dx, al

    mov dx, VGA_GC_INDEX
    mov al, 0x01
    out dx, al
    inc dx
    mov al, 0x0F
    out dx, al

    mov cx, 38400
    xor di, di
    rep stosb

    mov dx, VGA_GC_INDEX
    mov al, 0x01
    out dx, al
    inc dx
    mov al, 0x00
    out dx, al

    popa
    ret

cursor_x db 0
cursor_y db 0
color_fg db 15
color_bg db 0

text_header db "----------------------- Custom 8x8 font for x16-PRos -----------------------", 0
text_msg1   db "ABCDEFGHIJKLMNOPQRSTUVWXYZ", 0
text_msg2   db "abcdefghijklmnopqrstuvwxyz", 0
text_msg3   db "01234567890 !@#$%^*", 0

align 2
FontTable:
    db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 ; Space
    db 0x18, 0x3C, 0x3C, 0x18, 0x18, 0x00, 0x18, 0x00 ; !
    db 0x66, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00 ; "
    db 0x6C, 0x6C, 0xFE, 0x6C, 0xFE, 0x6C, 0x6C, 0x00 ; #
    db 0x18, 0x3E, 0x60, 0x3C, 0x06, 0x7C, 0x18, 0x00 ; $
    db 0x00, 0xC6, 0xCC, 0x18, 0x30, 0x66, 0xC6, 0x00 ; %
    db 0x38, 0x6C, 0x38, 0x76, 0xDC, 0xCC, 0x76, 0x00 ; &
    db 0x18, 0x18, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00 ; '
    db 0x0C, 0x18, 0x30, 0x30, 0x30, 0x18, 0x0C, 0x00 ; (
    db 0x30, 0x18, 0x0C, 0x0C, 0x0C, 0x18, 0x30, 0x00 ; )
    db 0x00, 0x66, 0x3C, 0xFF, 0x3C, 0x66, 0x00, 0x00 ; *
    db 0x00, 0x18, 0x18, 0x7E, 0x18, 0x18, 0x00, 0x00 ; +
    db 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x30, 0x00 ; ,
    db 0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00, 0x00 ; -
    db 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00 ; .
    db 0x00, 0x03, 0x06, 0x0C, 0x18, 0x30, 0x60, 0x00 ; /

    db 0x3C, 0x66, 0x6E, 0x76, 0x66, 0x66, 0x3C, 0x00 ; 0
    db 0x18, 0x38, 0x18, 0x18, 0x18, 0x18, 0x7E, 0x00 ; 1
    db 0x3C, 0x66, 0x06, 0x0C, 0x30, 0x60, 0x7E, 0x00 ; 2
    db 0x3C, 0x66, 0x06, 0x1C, 0x06, 0x66, 0x3C, 0x00 ; 3
    db 0x06, 0x0E, 0x1E, 0x36, 0x7F, 0x06, 0x06, 0x00 ; 4
    db 0x7E, 0x60, 0x7C, 0x06, 0x06, 0x66, 0x3C, 0x00 ; 5
    db 0x3C, 0x66, 0x60, 0x7C, 0x66, 0x66, 0x3C, 0x00 ; 6
    db 0x7E, 0x06, 0x0C, 0x18, 0x30, 0x30, 0x30, 0x00 ; 7
    db 0x3C, 0x66, 0x66, 0x3C, 0x66, 0x66, 0x3C, 0x00 ; 8
    db 0x3C, 0x66, 0x66, 0x3E, 0x06, 0x66, 0x3C, 0x00 ; 9

    db 0x00, 0x18, 0x18, 0x00, 0x00, 0x18, 0x18, 0x00 ; :
    db 0x00, 0x18, 0x18, 0x00, 0x18, 0x18, 0x30, 0x00 ; ;
    db 0x06, 0x0C, 0x18, 0x30, 0x18, 0x0C, 0x06, 0x00 ; <
    db 0x00, 0x00, 0x7E, 0x00, 0x7E, 0x00, 0x00, 0x00 ; =
    db 0x60, 0x30, 0x18, 0x0C, 0x18, 0x30, 0x60, 0x00 ; >
    db 0x3C, 0x66, 0x06, 0x0C, 0x18, 0x00, 0x18, 0x00 ; ?
    db 0x3C, 0x66, 0x6E, 0x6E, 0x60, 0x66, 0x3C, 0x00 ; @

    db 0x18, 0x3C, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x00 ; A
    db 0x7C, 0x66, 0x66, 0x7C, 0x66, 0x66, 0x7C, 0x00 ; B
    db 0x3C, 0x66, 0x60, 0x60, 0x60, 0x66, 0x3C, 0x00 ; C
    db 0x78, 0x6C, 0x66, 0x66, 0x66, 0x6C, 0x78, 0x00 ; D
    db 0x7E, 0x60, 0x60, 0x78, 0x60, 0x60, 0x7E, 0x00 ; E
    db 0x7E, 0x60, 0x60, 0x78, 0x60, 0x60, 0x60, 0x00 ; F
    db 0x3C, 0x66, 0x60, 0x6E, 0x66, 0x66, 0x3C, 0x00 ; G
    db 0x66, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00 ; H
    db 0x3C, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3C, 0x00 ; I
    db 0x1E, 0x0C, 0x0C, 0x0C, 0x0C, 0xCC, 0x78, 0x00 ; J
    db 0xE6, 0x66, 0x6C, 0x78, 0x6C, 0x66, 0xE6, 0x00 ; K
    db 0xF0, 0x60, 0x60, 0x60, 0x60, 0x60, 0xFE, 0x00 ; L
    db 0xC6, 0xEE, 0xFE, 0xD6, 0xC6, 0xC6, 0xC6, 0x00 ; M
    db 0xC6, 0xE6, 0xF6, 0xDE, 0xCE, 0xC6, 0xC6, 0x00 ; N
    db 0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00 ; O
    db 0xFC, 0x66, 0x66, 0x7C, 0x60, 0x60, 0xF0, 0x00 ; P
    db 0x78, 0xCC, 0xCC, 0xCC, 0xDC, 0x78, 0x1C, 0x00 ; Q
    db 0xFC, 0x66, 0x66, 0x7C, 0x6C, 0x66, 0xE6, 0x00 ; R
    db 0x7C, 0x66, 0x60, 0x3C, 0x06, 0x66, 0x7C, 0x00 ; S
    db 0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00 ; T
    db 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00 ; U
    db 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x00 ; V
    db 0xC6, 0xC6, 0xC6, 0xD6, 0xFE, 0xEE, 0xC6, 0x00 ; W
    db 0xC6, 0x6C, 0x38, 0x38, 0x38, 0x6C, 0xC6, 0x00 ; X
    db 0x66, 0x66, 0x66, 0x3C, 0x18, 0x18, 0x18, 0x00 ; Y
    db 0xFE, 0x06, 0x0C, 0x18, 0x30, 0x60, 0xFE, 0x00 ; Z

    db 0x1E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x1E, 0x00 ; [
    db 0x00, 0x60, 0x30, 0x18, 0x0C, 0x06, 0x03, 0x00 ; Backslash
    db 0x78, 0x18, 0x18, 0x18, 0x18, 0x18, 0x78, 0x00 ; ]
    db 0x08, 0x1C, 0x36, 0x63, 0x00, 0x00, 0x00, 0x00 ; ^
    db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00 ; _
    db 0x18, 0x0C, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00 ; `

    db 0x00, 0x00, 0x78, 0x0C, 0x7C, 0xCC, 0x76, 0x00 ; a
    db 0xE0, 0x60, 0x60, 0x7C, 0x66, 0x66, 0x7C, 0x00 ; b
    db 0x00, 0x00, 0x3C, 0x66, 0x60, 0x66, 0x3C, 0x00 ; c
    db 0x0E, 0x06, 0x06, 0x3E, 0x66, 0x66, 0x3E, 0x00 ; d
    db 0x00, 0x00, 0x3C, 0x66, 0x7E, 0x60, 0x3C, 0x00 ; e
    db 0x1C, 0x36, 0x30, 0x78, 0x30, 0x30, 0x78, 0x00 ; f
    db 0x00, 0x00, 0x3B, 0x66, 0x66, 0x3E, 0x06, 0x7C ; g
    db 0xE0, 0x60, 0x6C, 0x76, 0x66, 0x66, 0xE6, 0x00 ; h
    db 0x18, 0x00, 0x38, 0x18, 0x18, 0x18, 0x3C, 0x00 ; i
    db 0x06, 0x00, 0x06, 0x06, 0x06, 0x66, 0x66, 0x3C ; j
    db 0xE0, 0x60, 0x66, 0x6C, 0x78, 0x6C, 0xE6, 0x00 ; k
    db 0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3C, 0x00 ; l
    db 0x00, 0x00, 0x66, 0xFF, 0xFF, 0xDB, 0xDB, 0x00 ; m
    db 0x00, 0x00, 0xDC, 0x66, 0x66, 0x66, 0x66, 0x00 ; n
    db 0x00, 0x00, 0x3C, 0x66, 0x66, 0x66, 0x3C, 0x00 ; o
    db 0x00, 0x00, 0xDC, 0x66, 0x66, 0x7C, 0x60, 0xF0 ; p
    db 0x00, 0x00, 0x76, 0xCC, 0xCC, 0x7C, 0x0C, 0x1E ; q
    db 0x00, 0x00, 0xDC, 0x66, 0x60, 0x60, 0xF0, 0x00 ; r
    db 0x00, 0x00, 0x3C, 0x60, 0x3C, 0x06, 0x7C, 0x00 ; s
    db 0x30, 0x78, 0x30, 0x30, 0x30, 0x30, 0x1C, 0x00 ; t
    db 0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x3E, 0x00 ; u
    db 0x00, 0x00, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x00 ; v
    db 0x00, 0x00, 0xC6, 0xD6, 0xFE, 0xEE, 0xC6, 0x00 ; w
    db 0x00, 0x00, 0xC6, 0x6C, 0x38, 0x6C, 0xC6, 0x00 ; x
    db 0x00, 0x00, 0x66, 0x66, 0x66, 0x3E, 0x06, 0x7C ; y
    db 0x00, 0x00, 0x7E, 0x0C, 0x18, 0x30, 0x7E, 0x00 ; z

    db 0x0C, 0x18, 0x18, 0x30, 0x18, 0x18, 0x0C, 0x00 ; {
    db 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00 ; |
    db 0x30, 0x18, 0x18, 0x0C, 0x18, 0x18, 0x30, 0x00 ; }
    db 0x00, 0x36, 0x5C, 0x00, 0x00, 0x00, 0x00, 0x00 ; ~

    times 1024 db 0